<link rel="stylesheet" href="css/styles.css"/>
<!DOCTYPE HTML>
<html lang="en">
<head>
    <title>Polytrack</title>
</head>
<body>
    <header>
        <a href="index.html">
            <img src="Images/NEWGhostyGames.png" class="logo" alt="Logo" style="width:180px;height:150px;">
        </a>
        <h1>Polytrack</h1>
        <nav>
            <a href="index.html">Home</a>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
            <a href="donate.html">Donate</a>
        </nav>

        <!-- Login / Profile -->
        <div class="login-container" id="login-container">
            <button id="login-button">
                <a href="login.html" id="login">Log In</a>
            </button>
        </div>
        <div id="profile-container" style="display:none;">
            <span id="user-email" style="margin-right:10px; font-weight:bold;"></span>
            <button id="logout-button">Log Out</button>
        </div>

        <!-- Favorite Button -->
        <div style="text-align:center; margin-top:20px;">
            <button id="favorite-button">Add to Favorites</button>
        </div>
    </header>

    <!-- Game Embed -->
    <main style="text-align:center; margin-top:20px;">
        <iframe src="https://openprocessing.org/sketch/2630795/embed"
            width="800"
            height="600"
            frameborder="0"
            allowfullscreen>
        </iframe>
    </main>

    <!-- Firebase Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDSpebs9nP97-IkXXGALGR2vCqcTTOzlyo",
            authDomain: "ghoatygames.firebaseapp.com",
            projectId: "ghoatygames",
            storageBucket: "ghoatygames.firebasestorage.app",
            messagingSenderId: "606779515816",
            appId: "1:606779515816:web:774ccc3cd8d7f895f7339d",
            measurementId: "G-CCE1LRLR46"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Handle auth state
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById("login-container").style.display = "none";
                document.getElementById("profile-container").style.display = "inline-block";
                document.getElementById("user-email").textContent = user.email;

                // Favorite button logic
                const favBtn = document.getElementById("favorite-button");
                favBtn.addEventListener("click", async () => {
                    try {
                        const favRef = doc(db, "users", user.uid, "favorites", "polytrack");
                        await setDoc(favRef, {
                            title: "Polytrack",
                            image: "Images/polytrack.png", // update with correct thumbnail path
                            url: "polytrack.html",
                            addedAt: new Date()
                        });
                        alert("Polytrack added to your Favorites!");
                    } catch (err) {
                        console.error("Error adding favorite:", err);
                        alert("Failed to add favorite.");
                    }
                });

            } else {
                document.getElementById("login-container").style.display = "inline-block";
                document.getElementById("profile-container").style.display = "none";
            }
        });

        // Logout
        document.getElementById("logout-button").addEventListener("click", () => {
            signOut(auth).then(() => {
                window.location.href = "dts_ghostygames_website.html";
            }).catch((error) => {
                console.error("Logout error:", error);
            });
        });
    </script>

    <script type="module" src="tracker.js"></script>
</body>
</html>
